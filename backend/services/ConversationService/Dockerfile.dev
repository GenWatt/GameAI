FROM mcr.microsoft.com/dotnet/sdk:9.0 AS development
WORKDIR /src

ENV API_PROJECT_NAME=ConversationService.Api
ENV APPLICATION_PROJECT_NAME=ConversationService.Application
ENV CORE_PROJECT_NAME=ConversationService.Core
ENV DOMAIN_PROJECT_NAME=ConversationService.Domain
ENV SHARED_PROJECT_NAME=Shared

ENV ASPNETCORE_ENVIRONMENT=Docker
ENV ASPNETCORE_URLS=http://+:5002
ENV DOTNET_USE_POLLING_FILE_WATCHER=true

EXPOSE 5002

# Copy project files (context is now services folder)
COPY ["ConversationService/src/${API_PROJECT_NAME}/${API_PROJECT_NAME}.csproj", "ConversationService/src/${API_PROJECT_NAME}/"]
COPY ["ConversationService/src/${APPLICATION_PROJECT_NAME}/${APPLICATION_PROJECT_NAME}.csproj", "ConversationService/src/${APPLICATION_PROJECT_NAME}/"]
COPY ["ConversationService/src/${CORE_PROJECT_NAME}/${CORE_PROJECT_NAME}.csproj", "ConversationService/src/${CORE_PROJECT_NAME}/"]
COPY ["ConversationService/src/${DOMAIN_PROJECT_NAME}/${DOMAIN_PROJECT_NAME}.csproj", "ConversationService/src/${DOMAIN_PROJECT_NAME}/"]
COPY ["${SHARED_PROJECT_NAME}/${SHARED_PROJECT_NAME}.csproj", "${SHARED_PROJECT_NAME}/"]

RUN dotnet restore "ConversationService/src/${API_PROJECT_NAME}/${API_PROJECT_NAME}.csproj"

# Copy source code
COPY ConversationService/. ConversationService/
COPY ${SHARED_PROJECT_NAME}/. ${SHARED_PROJECT_NAME}/

ENTRYPOINT dotnet watch run --project ConversationService/src/${API_PROJECT_NAME}/${API_PROJECT_NAME}.csproj --no-launch-profile