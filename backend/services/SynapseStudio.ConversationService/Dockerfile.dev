FROM mcr.microsoft.com/dotnet/sdk:9.0 AS development
WORKDIR /src

ENV API_PROJECT_NAME=SynapseStudio.ConversationService.Api
# ENV APPLICATION_PROJECT_NAME=SynapseStudio.ConversationService.Application
# ENV CORE_PROJECT_NAME=SynapseStudio.ConversationService.Core
# ENV DOMAIN_PROJECT_NAME=SynapseStudio.ConversationService.Domain
ENV SHARED_PROJECT_NAME=SynapseStudio.Shared
ENV PROJECT_NAME=SynapseStudio.ConversationService

ENV ASPNETCORE_ENVIRONMENT=Docker
ENV ASPNETCORE_URLS=http://+:5002
ENV DOTNET_USE_POLLING_FILE_WATCHER=true

EXPOSE 5002

COPY ["services/${PROJECT_NAME}", "services/${PROJECT_NAME}"]
COPY ["services/${SHARED_PROJECT_NAME}", "services/${SHARED_PROJECT_NAME}/"]

RUN dotnet restore "services/${PROJECT_NAME}/src/${API_PROJECT_NAME}/${API_PROJECT_NAME}.csproj"

CMD ["dotnet", "watch", "run", "--project", "services/SynapseStudio.ConversationService/src/SynapseStudio.ConversationService.Api/SynapseStudio.ConversationService.Api.csproj", "--no-launch-profile"]